services:
  opencode:
    build:
      context: .
      dockerfile: Dockerfile
    image: opencode-super:latest
    stdin_open: true
    tty: true
    user: ${OPENCODE_UID:-1000}:${OPENCODE_GID:-1000}
    read_only: true
    cap_drop:
      - ALL
    security_opt:
      - no-new-privileges:true
    pids_limit: 512
    tmpfs:
      - /tmp:rw,noexec,nosuid,size=256m,mode=1777
      - /home/opencode/.cache:rw,noexec,nosuid,size=256m,uid=${OPENCODE_UID:-1000},gid=${OPENCODE_GID:-1000},mode=0755
      - /home/opencode/.local/state:rw,noexec,nosuid,size=128m,uid=${OPENCODE_UID:-1000},gid=${OPENCODE_GID:-1000},mode=0755
    working_dir: /workspace
    volumes:
      - ${PWD}:/workspace
      - ${HOME}/.local/share/opencode:/home/opencode/.local/share/opencode
    environment:
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      CONTEXT7_API_KEY: ${CONTEXT7_API_KEY:-}
      EXA_API_KEY: ${EXA_API_KEY:-}
